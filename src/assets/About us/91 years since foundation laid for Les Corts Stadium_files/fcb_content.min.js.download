"use strict";PULSE.app.templates["barca-today-items"]=_.template('<li class="barca-today__item js-thumb"> <% if (isContent) { %> <a href="<%= url %>" class="content-today content-today--link content-today--<%= contentType %>"> <% } else { %> <div class="content-today content-today--<%= contentType %>"> <% } %> <picture class="content-today__picture js-lazy-picture" data-odir="true" data-img-src="<%= photo %>"></picture> <% if (typeof photo === \'string\') { %> <img src="" data-image-src="<%= photo %>" alt="<%= contentType + \' photo\' %>" class="content-today__photo"> <% } %>  <% if (isContent) { %> <div class="content-today__content-type"> <svg class="content-today__type-icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/resources/<%= window.RESOURCE_VERSION %>/i/svg-output/icn.svg#<%= contentType %>"></use></svg> <span class="visually-hidden"><%= contentType %></span> <span class="content-today__type"><%= PULSE.I18N.lookup(\'label.\' + contentType) %></span> </div> <% } else { %> <a href="<%= content.link %>" class="content-today__content-type content-today__content-type--link" target="_blank" rel="noopener"> <svg class="content-today__type-icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/resources/<%= window.RESOURCE_VERSION %>/i/svg-output/icn.svg#<%= contentType %>"></use></svg> <span class="visually-hidden"><%= contentType %></span> <span class="content-today__type"><%= content.atChar + content.user.account %></span> </a> <% } %> <div class="content-today__content"> <span class="content-today__title"><%= content.title || content.text || \'\' %></span> </div> <% if (isContent) { %> </div></a> <% } else { %>  <% } %> </li>'),PULSE.app.templates["news-feed-container"]=_.template('<div class="feed__container js-feed-container"> <div class="branding-bar"></div> <div class="feed__date"> <div class="feed__day"><%= date.format(\'dddd\') %></div> <% var dateFormat = PULSE.app.language === \'ja\' ? \'MMMDæ—¥\' : \'MMMM DD\'; %> <div class="feed__month"><%= date.format(dateFormat) %></div> </div> <div class="feed__items js-feed-items"></div> </div>'),PULSE.app.templates["news-feed-empty"]=_.template("<%= PULSE.I18N.lookup( 'label.sorrynocontent' ) %>"),function(t,e){const n=function(){const t=this,e={contentTypes:"TEXT,VIDEO,PLAYLIST",limit:t.maxLimit,tagExpression:`"${CONSTANTS.TAGS.TYPE.NEWS.tag}" or "${CONSTANTS.TAGS.TYPE.GALLERY.tag}" or "${CONSTANTS.TAGS.TYPE.VIDEO.tag}"`},n=axios.get(URL_HELPER.getMultiContentUrl(e)),o=axios.get(URL_HELPER.getSocialStreamUrl(t.streamId,t.maxLimit));Promise.all([n,o]).then(([e,n])=>{const o=i(n.data.content),l=e.data.content.concat(o).sort((t,e)=>e.publishFrom-t.publishFrom);a.call(t,l.slice(0,t.maxLimit))})},o=function(t){if(t.photo)return t.photo;switch(t.type){case"text":return t.leadMedia;case"video":return t.thumbnail;case"playlist":return t.coverItem;default:return""}},i=function(t){return t.map(t=>SOCIAL_HELPER.getSocialModel(t)).filter(t=>t.photo.length>0)},a=function(e){const n=this;if(0===e.length)return;let i="";e.forEach(t=>{const e=function(t){if(t.feedType)return t.feedType;switch(t.type){case"text":return"news";case"video":return"video";case"playlist":return"gallery";default:return""}}(t),a="video"===e||"news"===e||"gallery"===e;let l="";if(a){const o="text"===e?n.isFeatured()?"featured":null:t.typeRestriction;l=URL_HELPER.generateUrl(e,t.id,o,t.title,"https",t.tags)}i+=TEMPLATE_HELPER.render({content:t,contentType:e,isContent:a,photo:o(t),url:l},"barca-today-items")}),n.contentContainer.innerHTML=i;const a=n.contentContainer.querySelectorAll(`.${CONSTANTS.JS_CLS_NAMES.LAZY_PICTURE_ELEMENT}`);for(let e=0;e<a.length;e++)new t.common.LazyPictureElement(a[e]);new t.ContentSlider(n.container)};t.BarcaToday=function(t){const o=this;o.container=t,o.contentContainer=o.container.querySelector(".js-barca-today-content"),o.maxLimit=Number(o.container.getAttribute("data-maxitems")||20),o.streamId=o.container.getAttribute("data-stream-id"),o.container.addEventListener(CONSTANTS.EVENT.ACTIVATE,n.bind(o)),e.GlobalIntersectionObserver.observe(o.container)};const l=document.querySelectorAll('[data-widget="barca-today"]');for(let e=0;e<l.length;e++)new t.BarcaToday(l[e])}(PULSE.app,PULSE.app.common),function(t,e,n){const o="is-active";t.CarouselHero=function(e){const n=this;n.container=e,n.tiles=[].slice.call(n.container.querySelectorAll(".js-hero-tile")),n.setListeners();const o=n.container.querySelectorAll(`.${CONSTANTS.JS_CLS_NAMES.LAZY_PICTURE_ELEMENT}`);for(let e=0;e<o.length;e++)new t.common.LazyPictureElement(o[e])},t.CarouselHero.prototype.setActive=function(t){this.tiles.forEach(t=>{n.style.removeClass(t,o)}),n.style.addClass(t.currentTarget,o)},t.CarouselHero.prototype.setListeners=function(){const t=this;for(let e=0;e<t.tiles.length;e++)t.tiles[e].addEventListener("mouseover",e=>t.setActive(e)),t.tiles[e].addEventListener("focusin",e=>t.setActive(e)),n.style.removeClass(t.tiles[e],"hero-tile--disabled")};const i=document.querySelectorAll('[data-widget="content-hero"]');for(let e=0;e<i.length;e++)new t.CarouselHero(i[e],{})}(PULSE.app,PULSE.app.common,PULSE.core),function(t,e,n){const o="feed--is-empty",i=function(t){switch(t.type){case"playlist":return"content-gallery-item";case"text":return"content-article-item";default:return""}},a=function(){const t=this;t.listContainer=null,t.showMoreElement=null,t.filterContainer=null,t.showMoreCheck=!1,t.fetchData=!1,t.pageLimit=CONSTANTS.CONTENT_API.DEFAULT_PAGE_SIZE,t.defaultTags=null,t.type=null,t.references=null,t.filter=null,t.columnClass=null,t.gridWidth=null,t.thumbnailClass=null,t.ignoreContent=null,t.additionalConfigClass=null},l=function(t){const e=this;e.listContainer=t.querySelector("[data-content-list]")||e.listContainer,e.showMoreElement=t.querySelector(`.${CONSTANTS.JS_CLS_NAMES.SHOW_MORE}`)||e.showMoreElement,e.filterContainer=t.querySelector("[data-content-filter]")||e.filterContainer,e.showMoreCheck="true"===t.getAttribute("data-show-more")||e.showMoreCheck,e.fetchData="true"===t.getAttribute("data-fetch")||e.fetchData,e.pageLimit=Number(t.getAttribute("data-page-size"))||e.pageLimit,e.defaultTags=t.getAttribute("data-tags")||e.defaultTags,e.type=t.getAttribute("data-type")||e.type,e.references=t.getAttribute("data-references")||e.references,e.filter=t.getAttribute("data-filter")||e.filter,e.gridWidth=t.getAttribute("data-grid-width")||e.gridWidth,e.columnClass=t.getAttribute("data-column-class")||e.columnClass,e.thumbnailClass=t.getAttribute("data-thumbnail-class")||e.thumbnailClass,e.ignoreContent=(t.getAttribute("data-ignore")||"").split(",")||e.ignoreContent,e.additionalConfigClass=t.getAttribute("data-additional-config")||e.additionalConfigClass,e.config.hideIfNoResults=t.getAttribute("data-hide-if-no-results")||e.config.hideIfNoResults||!1,e.pagination={offset:0,limit:e.pageLimit}},s=function(){const t=this;if(!t.additionalConfigClass)return;const e=document.querySelector(t.additionalConfigClass);e&&l.call(t,e)},r=function(){this.getContentData(!1)};t.ContentList=function(t,n){const o=this;o.element=t,o.config=n||{},a.call(o),l.call(o,o.element),s.call(o);let i={offset:0,limit:parseInt(o.pageLimit),tagNames:o.defaultTags};o.type&&(i.contentTypes=CONSTANTS.CONTENT_API.MIXED_CONTENT_TYPES),o.listFilter=new e.FilterOptions(i),o.filter&&(o.filterContainer=new e.FilterOptions(o,o.filterContainer)),function(t){switch(t.type){case"gallery-list":t.listFilter.updateFilters({playlistTypeRestriction:"photo"});break;case"news-feed":case"news-list":t.thumbnailClass="thumbnail--wide",t.template="content-news-feed-item";break;case"mixed-content":t.columnClass="col-3 col-6-desk col-12-phab"}}(o),o.showMoreCheck&&(o.showMore=new e.ShowMore(o.showMoreElement,{callback:r.bind(o)})),o.fetchData&&o.getContentData(!0)},t.ContentList.prototype.getContentData=function(e){const o=this;e?o.listFilter.updateFilters({offset:0}):o.listFilter.updateFilters({offset:o.listFilter.get().offset+o.pageLimit});let i="";switch(o.type){case"gallery-list":i=t.apiPath.cms.playlist+"?"+n.url.buildQueryString(o.listFilter.get());break;case"news-feed":case"news-list":i=t.apiPath.cms.text+"?"+n.url.buildQueryString(o.listFilter.get());break;case"mixed-content":i=t.apiPath.cms.general+"?"+n.url.buildQueryString(o.listFilter.get())}const a={url:i,callback:t=>{o.render(t,e)},forceCallback:!0,target:o};n.data.manager.add(a)},t.ContentList.prototype.update=function(t){const e=this;if("FORMAT"===t.type)"ALL"===t.key?e.listFilter.updateFilters({tagNames:e.defaultTags}):e.listFilter.updateFilters({tagNames:t.key});e.page=0,e.listFilter.updateFilters({page:0}),e.getContentData(!0)},t.ContentList.prototype.isEmpty=function(){return n.style.hasClass(this.listContainer,o)},t.ContentList.prototype.render=function(a,l){const s=this;let r={items:[]};void 0!==a.content&&a.content.length>0&&(r.items=a.content.map(function(t){return new e.ContentModel(t,{gridWidth:s.gridWidth,columnClass:s.columnClass,thumbnailClass:s.thumbnailClass,template:s.template||i(t)})}),n.style.removeClass(s.listContainer,o)),s.showMore&&0===r.items.length?s.showMore.hide():(l&&(s.listContainer.innerHTML="",0===a.content.length&&(n.style.addClass(s.listContainer,o),s.listContainer.innerHTML=TEMPLATE_HELPER.render({},"news-feed-empty"))),r.items.forEach(function(t){s.ignoreContent.includes(t.data.id.toString())||s.listContainer.appendChild(t.element)}),s.config.hideIfNoResults&&0===s.listContainer.children.length?n.style.addClass(s.element,CONSTANTS.STYLE_CLS_NAMES.HIDE):n.style.removeClass(s.element,CONSTANTS.STYLE_CLS_NAMES.HIDE),s.showMore&&s.showMore.setPagination(s.pagination),t.common.articleModal&&t.common.articleModal.modal.addThumbListeners(s.listContainer.querySelectorAll(`.${CONSTANTS.JS_CLS_NAMES.ARTICLE_MODAL_EXPAND_THUMB}`)),"function"==typeof s.config.onRenderCallback&&s.config.onRenderCallback(r))};const c=document.querySelectorAll('[data-widget="content-list"]');for(let e=0;e<c.length;e++)new t.ContentList(c[e],{})}(PULSE.app,PULSE.app.common,PULSE.core),function(t){const e=document.querySelectorAll('[data-widget="content-trending"]');for(let n=0;n<e.length;n++)new t.ContentSlider(e[n])}(PULSE.app),function(t,e,n){const o=function(){const t=this;t.container.addEventListener(CONSTANTS.EVENT.ACTIVATE,()=>{n.style.addClass(t.container,`gallery-featured-widget${CONSTANTS.STYLE_CLS_MODIFIERS.ACTIVE}`)})};t.FeaturedContentWidget=function(t){const n=this;n.container=t,o.call(n),e.GlobalIntersectionObserver.observe(n.container)};const i=document.querySelectorAll('[data-widget="featured-content-widget"]');for(let e=0;e<i.length;e++)new t.FeaturedContentWidget(i[e],{})}(PULSE.app,PULSE.app.common,PULSE.core,CONSTANTS),function(t,e){t.GalleryAlbum=function(t){new e.GalleryAlbum(t)};const n=document.querySelectorAll('[data-widget="gallery-album"]');for(let e=0;e<n.length;e++)new t.GalleryAlbum(n[e])}(PULSE.app,PULSE.app.common),function(t,e,n){const o="js-thumbnail",i=function(){this.intersectionObserver=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&n.style.addClass(t.target,CONSTANTS.STYLE_CLS_NAMES.IS_VISIBLE)})},{threshold:.6})},a=function(t){const e=this;for(let n=0;n<t.length;n++)e.intersectionObserver.observe(t[n])},l=function(){const e=this;e.filterController&&e.filterController.stopLoading();const n=e.content.querySelectorAll("[data-publish-date]");s.call(e,n),t.common.articleModal&&t.common.articleModal.modal.addThumbListeners(e.content.querySelectorAll(`.${CONSTANTS.JS_CLS_NAMES.ARTICLE_MODAL_EXPAND_THUMB}`)),a.call(e,e.content.querySelectorAll(`.${o}`)),e.contentList.isEmpty()&&e.container.scrollIntoView({behavior:"smooth",block:"start"})},s=function(t){const e=this;for(let o=0;o<t.length;o++){const i=moment(Number(t[o].dataset.publishDate)),a=i.format("DD MMMM YYYY");if(a===e.lastDate)r.call(e,t[o]);else{const l=TEMPLATE_HELPER.render({date:i},"news-feed-container");n.dom.appendDomString(e.content,l),r.call(e,t[o]),e.lastDate=a}t[o].removeAttribute("data-publish-date")}},r=function(t){this.content.querySelector(".js-feed-container:last-of-type").querySelector(".js-feed-items").appendChild(t)},c=function(t){const e=this;e.contentList.listFilter.updateFilters(t),e.contentList.getContentData(!0),e.filterController.startLoading()},d=function(t){const e=this;t.forEach(t=>{t.intersectionRatio>=PRESET_CONFIG.OBSERVER_CONFIG.threshold?e.filterController.show():e.filterController.hide()})};t.ContentFeed=function(e){const s=this;s.container=e,s.content=s.container.querySelector("[data-content-list]"),s.filters=document.querySelector(".js-news-feed-filter"),s.lastDate=s.container.getAttribute("data-last-date"),s.widgetEnd=s.container.querySelector(".js-show-more"),s.hideFilters=n.style.hasClass(s.container,"no-filter"),i.call(s),a.call(s,s.container.querySelectorAll(`.${o}`)),!s.hideFilters&&s.filters&&(s.filters=DOM_HELPER.safeInsertAfterNavigation(s.filters)),s.contentList=new t.ContentList(s.container,{onRenderCallback:l.bind(s)}),s.filters&&(s.observer=new IntersectionObserver(d.bind(s),PRESET_CONFIG.OBSERVER_CONFIG),s.observer.observe(s.container),s.filterController=new t.common.FilterController(s.filters,{dropdowns:t.filterData.filters.news,onFilterUpdate:c.bind(s),preventFetch:!0,parentWidget:s.container,type:t.apiPath.cms.text}))};const u=document.querySelectorAll('[data-widget="content-feed"]');for(let e=0;e<u.length;e++)new t.ContentFeed(u[e])}(PULSE.app,PULSE.app.common,PULSE.core);